# coding: utf-8
# email: qfsfdxlqy@163.com
# Github: https://github.com/2015qyliang

##########################################################################

library(tidyverse)
library(ggplot2)
library(ggsci)

##########################################################################

vulDF = read.table('06-EffiVulnDF.txt', header = T, sep = '\t', stringsAsFactors = F)
m.vuldf = vulDF[vulDF$Group == 'D00C', ]
m.vuldf$Group = 'D00M'
vulDF = rbind(vulDF, m.vuldf)

vulDF$TimeGp = as.integer(substr(vulDF$Group, 2, 3))
vulDF$GP = substr(vulDF$Group, 4, 4)

p = ggplot(vulDF, aes(x = TimeGp, y = vulnerability, color = GP, group = GP)) +
  geom_point(size = 1) + 
  geom_smooth(method = "lm", se = F, size = 0.3, alpha = 0.5) + 
  scale_color_manual(values = c('#E69F00', '#0072B2'))+ 
  labs(x= NULL, y = 'Vulnerability') +
  theme( panel.background = element_rect(fill="white",color="black"),
         panel.grid = element_blank(), 
         axis.text.x = element_text(size = 10),
         axis.text.y = element_text(size = 8, angle = 90, hjust = 0.5, vjust = 0.5),
         axis.title.y = element_text(size = 10), 
         legend.position = 'none')

ggsave('11-SimulationVulnetability.pdf', p, units = 'in', width = 3, height = 2.5)

##########################################################################

vulDF$time = as.integer(substr(vulDF$Group, 2, 3))

vulDF.lm = vulDF[vulDF$GP == 'C', ]
res = summary(lm(vulDF.lm$vulnerability~vulDF.lm$time))
res$coefficients[,'Estimate'][1]
res$r.squared
res$coefficients[,'Pr(>|t|)'][2]
# > res$coefficients[,'Estimate'][1]
# (Intercept) 
# 0.03646159 
# > res$r.squared
# [1] 0.3342356
# > res$coefficients[,'Pr(>|t|)'][2]
# vulDF.lm$time 
# 0.3072565 

print('#####################')

vulDF.lm = vulDF[vulDF$GP == 'M', ]
res = summary(lm(vulDF.lm$vulnerability~vulDF.lm$time))
res$coefficients[,'Estimate'][1]
res$r.squared
res$coefficients[,'Pr(>|t|)'][2]
# > res$coefficients[,'Estimate'][1]
# (Intercept) 
# 0.04967738 
# > res$r.squared
# [1] 0.2183166
# > res$coefficients[,'Pr(>|t|)'][2]
# vulDF.lm$time 
# 0.4275044
